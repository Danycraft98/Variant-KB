<html lang='en'>
<head>
    <title>Variant and Disease</title>
    <style>
        body {
            background-color: #f7f7f8;
        }
    </style>
</head>
<body>
<div class='container-fluid px-5 pb-5'>
    <h2>Diseases Exported</h2>
    <div class='row form-group'>
        <div class='col-2'><strong>Variant:</strong></div>
        <div class='col-9'>{{ item }}</div>
    </div>
    <div class='row form-group'>
        <div class='col-2'><strong>Gene:</strong></div>
        <div class='col-9'>{{ item.gene }}</div>
    </div>

    {% for disease in diseases.all %}
        <div class='row form-group'>
            <div class='col-2'><strong>Disease Name:</strong></div>
            <div class='col-9'>{{ disease.name }}</div>
        </div>
        <div class='row form-group'>
            <div class='col-2'><strong>Disease Report</strong></div>
            <div class='col-9'>{{ disease.report }}</div>
        </div>
        <br/>
        {% if disease.score.first %}
            <div class='card'>
                <div class='card-header'>2015 ACMG Score Result</div>
                <div class='card-body ml-3'>
                    <div class='row form-group'>
                        <div class='col-1'></div>
                        <div class='col-3'>Evidence FOR Pathogenicity</div>
                        <div class='col-5'>{{ disease.score.first.for_score }}</div>
                    </div>
                    <div class='row form-group'>
                        <div class='col-1'></div>
                        <div class='col-3'>Evidence AGAINST Pathogenicity</div>
                        <div class='col-5'>{{ disease.score.first.against_score }}</div>
                    </div>
                </div>
            </div>
            <br/>

            {% regroup disease.evidences.all by item as dict_items %}

            <div class='card'>
            <div class='card-header'>
                Evidence FOR Pathogenicity
            </div>
            <div class='card-body ml-3'>
                {% for set in dict_items %}
                    {% if 'P' in set.grouper.key and 'B' not in set.grouper.key %}
                        <div class='row'>
                        <div class='col-1'>
                            <strong>{{ set.grouper }}</strong>
                        </div>
                        {% for evidence in set.list %}
                            {% if forloop.counter > 1 %}
                                <div class='row'>
                                <div class='col-1'></div>
                            {% endif %}
                        <div class='col-2'><strong>Source Type</strong></div>
                        <div class='col-3'>{{ evidence.get_source_type_display }}</div>
                        </div>
                            <div class='row'>
                                <div class='col-1'></div>
                                <div class='col-2'><strong>Source ID</strong></div>
                                <div class='col-3'>{{ evidence.source_id }}</div>
                            </div>
                            <div class='row mb-4'>
                                <div class='col-1'></div>
                                <div class='col-2'><strong>Evidence Statement</strong></div>
                                <div class='col-6'>{{ evidence.statement }}</div>
                                <div class='col-3'>{{ evidence.histories.last }}</div>
                            </div>
                        {% endfor %}
                    {% endif %}
                    <hr/>
                {% endfor %}
                </div>
            </div>
            <br/>

            <div class='card'>
                <div class='card-header'>
                    Evidence AGAINST Pathogenicity
                </div>
                <div class='card-body ml-3'>
                    {% for set in dict_items %}
                        {% if 'B' in set.grouper.key %}
                            <div class='row'>
                            <div class='col-1'>
                                <label>{{ set.grouper }}</label>
                            </div>
                            {% for evidence in set.list %}
                                {% if forloop.counter > 1 %}
                                    <div class='row'>
                                    <div class='col-1'></div>
                                {% endif %}
                            <div class='col-1'><label>Source</label></div>
                            <div class='col-2'>Type: {{ evidence.get_source_type_display }}</div>
                            </div>
                                <div class='row'>
                                    <div class='col-3'><strong>Source Type</strong></div>
                                    <div class='col-2'>{{ evidence.get_source_type_display }}</div>
                                </div>
                                <div class='row'>
                                    <div class='col-3'><strong>Source ID</strong></div>
                                    <div class='col-2'>{{ evidence.source_id }}</div>
                                </div>
                                <div class='row mb-4'>
                                    <div class='col-3'><strong>Evidence Statement</strong></div>
                                    <div class='col-7'>{{ item.statement }}</div>
                                    <div class='col-2'>{{ item.histories.last }}</div>
                                </div>
                            {% endfor %}
                        {% endif %}
                    {% endfor %}
                    </div>
                </div>
                <br/>

                {% else %}

                <div class='card-body ml-3'>
                    {% for set in disease.functionals.all %}
                        {% if forloop.counter == 1 %}
                            <div class='row form-group'>
                                <div class='col-3'><strong>Functional Significance</strong></div>
                                <div class='col-3'>{{ set.key }}</div>
                            </div>
                        {% endif %}
                        <div class='row form-group'>
                            <div class='col-3'><strong>Functional Class</strong></div>
                            <div class='col-3'>{{ set.value }}</div>
                        </div>
                        {% for evidence in set.evidences.all %}
                            <div class='row form-group'>
                                <div class='col-3'><strong>Source Type</strong></div>
                                <div class='col-2'>{{ evidence.get_source_type_display }}</div>
                            </div>
                            <div class='row form-group'>
                                <div class='col-3'><strong>Source ID</strong></div>
                                <div class='col-2'>{{ evidence.source_id }}</div>
                            </div>
                            <div class='row form-group mb-4'>
                                <div class='col-3'><strong>Evidence Statement</strong></div>
                                <div class='col-7'>{{ evidence.statement }}</div>
                                <div class='col-2'>{{ evidence.histories.last }}</div>
                            </div>
                        {% endfor %}
                        <hr/>
                    {% endfor %}
                    {% for evidence in disease.evidences.all %}
                        <div class='row form-group'>
                            <div class='col-3'><strong>Source Type</strong></div>
                            <div class='col-2'>{{ evidence.get_source_type_display }}</div>
                        </div>
                        <div class='row form-group'>
                            <div class='col-3'><strong>Source ID</strong></div>
                            <div class='col-2'>{{ evidence.source_id }}</div>
                        </div>
                        <div class='row form-group'>
                            <div class='col-3'><strong>Evidence Statement</strong></div>
                            <div class='col-7'>{{ evidence.statement }}</div>
                            <div class='col-2'>{{ evidence.histories.last }}</div>
                        </div>
                        {% with sub=evidence.subevidences.first %}
                            <div class='row form-group'>
                                <div class='col-3'><strong>Evidence Significance</strong></div>
                                <div class='col-2'>{{ sub.evid_sig }}</div>
                            </div>
                            <div class='row form-group'>
                                <div class='col-3'><strong>Evidence Level</strong></div>
                                <div class='col-2'>{{ sub.level }}</div>
                            </div>
                            <div class='row form-group'>
                                <div class='col-3'><strong>Evidence Direction</strong></div>
                                <div class='col-2'>{{ sub.evid_dir }}</div>
                            </div>
                            <div class='row form-group'>
                                <div class='col-3'><strong>Clinical Significance</strong></div>
                                <div class='col-2'>{{ sub.clin_sig }}</div>
                            </div>
                            <div class='row form-group'>
                                <div class='col-3'><strong>Drug / Class</strong></div>
                                <div class='col-2'>{{ sub.drug_class }}</div>
                            </div>
                            <div class='row form-group'>
                                <div class='col-3'><strong>Significance</strong></div>
                                <div class='col-2'>{{ sub.evid_rating }}</div>
                            </div>
                        {% endwith %}
                        <hr/>
                    {% endfor %}
                </div>
            </div>
            <br/>
        {% endif %}
    {% endfor %}
    </div>
</div>
</body>
</html>