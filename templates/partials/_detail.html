{% if item.genome_build and item.genome_build != "nan" %}
<div class="d-flex justify-content-center ">
    <div class="col-3 text-right">
        <strong class="">genome build</strong>
    </div>
    <div class="col-custom p-0"></div>
    <div class="col-6 ">{{ item.genome_build }}</div>
</div>
{% endif %}
{% if item.chromosome and item.chromosome != "nan" %}
<div class="d-flex justify-content-center pt-2 text">
    <div class="col-3 text-right">
        <strong class="">chromosome</strong>
    </div>
    <div class="col-custom p-0"></div>
    <div class="col-6 ">{{ item.chromosome }}</div>
</div>
{% endif %}
{% if item.start and item.start != "nan" %}
<div class="d-flex justify-content-center pt-2 text">
    <div class="col-3 text-right">
        <strong class="">start</strong>
    </div>
    <div class="col-custom p-0"></div>
    <div class="col-6 ">{{ item.start }}</div>
</div>
{% endif %}
{% if item.end and item.end != "nan" %}
<div class="d-flex justify-content-center pt-2 text">
    <div class="col-3 text-right">
        <strong class="">end</strong>
    </div>
    <div class="col-custom p-0"></div>
    <div class="col-6 ">{{ item.end }}</div>
</div>
{% endif %}
{% if item.ref and item.ref != "nan" %}
<div class="d-flex justify-content-center pt-2 text">
    <div class="col-3 text-right">
        <strong class="">ref</strong>
    </div>
    <div class="col-custom p-0"></div>
    <div class="col-6 ">{{ item.ref }}</div>
</div>
{% endif %}
{% if item.alt and item.alt != "nan" %}
<div class="d-flex justify-content-center pt-2 text">
    <div class="col-3 text-right">
        <strong class="">alt</strong>
    </div>
    <div class="col-custom p-0"></div>
    <div class="col-6 ">{{ item.alt }}</div>
</div>
{% endif %}
{% if item.transcript and item.transcript != "nan" %}
<div class="d-flex justify-content-center pt-2 text">
    <div class="col-3 text-right">
        <strong class="">Refseq Transcript</strong>
    </div>
    <div class="col-custom p-0"></div>
    <div class="col-6 ">{{ item.transcript }}</div>
</div>
{% endif %}
{% if item.c and item.c != "nan" %}
<div class="d-flex justify-content-center pt-2 text">
    <div class="col-3 text-right">
        <strong class="">c.</strong>
    </div>
    <div class="col-custom p-0"></div>
    <div class="col-6 ">{{ item.c }}</div>
</div>
{% endif %}
{% if item.p and item.p != "nan" %}
<div class="d-flex justify-content-center pt-2 text">
    <div class="col-3 text-right">
        <strong class="">p.</strong>
    </div>
    <div class="col-custom p-0"></div>
    <div class="col-6 ">{{ item.p }}</div>
</div>
{% endif %}
{% if item.chromosome and item.chromosome != "nan" and item.start and item.start != "nan"%}
<div class="d-flex justify-content-center pt-2 text">
    <div class="col-3 text-right">
        <strong class="">IGV</strong>
    </div>
    <div class="col-custom p-0"></div>
    <div class="col-6 "><a target="_blank" href="http://localhost:60151/goto?locus={{ item.chromosome }}:{{ item.start }}">Link to IGV</a></div>
</div>
{% endif %}
{% if item.chromosome and item.chromosome != "nan" and item.start and item.start != "nan" and item.end and item.end != "nan"%}
<div class="d-flex justify-content-center pt-2 text">
    <div class="col-3 text-right">
        <strong class="">UCSC</strong>
    </div>
    <div class="col-custom p-0"></div>
    <div class="col-6 "><a target="_blank" href="http://https://genome.ucsc.edu/cgi-bin/hgTracks?db=hg19&position={{ item.chromosome }}:{{ item.start }}-{{ item.end }}">Link to UCSC</a></div>
</div>
{% endif %}
<div class="d-flex justify-content-center pt-2 text">
    <div class="col-3 text-right">
        <strong class="">HGMD</strong>
    </div>
    <div class="col-custom p-0"></div>
    <div class="col-6 "><a target="_blank" href="https://portal.biobase-international.com/hgmd/pro/gene.php?gene={{ item.gene.name }}">Link to HGMD</a></div>
</div>
{% if item.consequence and item.consequence != "nan" %}
<div class="d-flex justify-content-center pt-2 text">
    <div class="col-3 text-right">
        <strong class="">consequence</strong>
    </div>
    <div class="col-custom p-0"></div>
    <div class="col-6 ">{{ item.consequence }}</div>
</div>
{% endif %}
<div class="d-flex justify-content-center pt-2 text">
    <div class="col-3 text-right">
        <strong class="">Gene</strong>
    </div>
    <div class="col-custom p-0"></div>
    <div class="col-6 ">{{ item.gene }}</div>
</div>
{% if item.gene.content %}
<div class="d-flex justify-content-center pt-2 text">
    <div class="col-3 text-right">
        <strong class="">Gene Report</strong>
    </div>
    <div class="col-custom p-0"></div>
    <div class="col-6 ">{{ item.gene.content }}</div>
</div>
{% endif %}
{% if item.content %}
<div class="d-flex justify-content-center pt-2 text">
    <div class="col-3 text-right">
        <strong class="">Variant Report</strong>
    </div>
    <div class="col-custom p-0"></div>
    <div class="col-6 ">{{ item.content }}</div>
</div>
{% endif %}
{% if item.gene.germline_content %}
<div class="d-flex justify-content-center pt-2 text">
    <div class="col-3 text-right">
        <strong class="">Gene Germline Report</strong>
    </div>
    <div class="col-custom p-0"></div>
    <div class="col-6 ">{{ item.gene.germline_content }}</div>
</div>
{% endif %}
{% if item.germline_content %}
<div class="d-flex justify-content-center pt-2 text">
    <div class="col-3 text-right">
        <strong class="">Variant Germline Report</strong>
    </div>
    <div class="col-custom p-0"></div>
    <div class="col-6 ">{{ item.germline_content }}</div>
</div>
{% endif %}
<div class="d-flex justify-content-center pt-2 text">
    <div class="col-3 text-right">
        <strong class="">Cancer Hotspot</strong>
    </div>
    <div class="col-custom p-0"></div>
    <div id="hotspot" class="col-6">
        <svg width="500" height="20"></svg>
    </div>
</div>


<script src="https://code.jquery.com/jquery-latest.min.js"></script>
<script src="https://d3js.org/d3.v4.min.js"></script>
<script>
    var color = d3.scaleOrdinal(d3.schemeCategory10).domain(["*","A","C","D","E","F","G","H","I","K","L","M","N","P","Q","R","S","T","V","W","Y","sp"]);
    var group = [{% for hotspot in item.hotspots.all %}"{{ hotspot.hotspot }}",{% endfor %}];
    var data = [{ {% for hotspot in item.hotspots.all %}"{{ hotspot.hotspot }}": {{ hotspot.count }},{% endfor %} }];
    var layers = d3.stack()
        .keys(group)
        .offset(d3.stackOffsetDiverging)
        (data);
    var tooltip = d3.select("body").append("div")
        .style("background", "rgba(0, 0, 0, 0.9)")
        .style("color", "white")
        .style("position", "absolute")
        .style("z-index", "10")
        .style("visibility", "hidden")
        .style("fill", "#000000")
        .attr("width", self.width + 10)
        .attr("height", self.height + 20);

    var svg = d3.select("svg");
    margin = {
        top: 20,
        right: 30,
        bottom: 60,
        left: 0
    };
    width = +svg.attr("width");
    height = +svg.attr("height");

    var x = d3.scaleLinear().rangeRound([margin.left, width - margin.right]);
    x.domain([d3.min(layers, stackMin), d3.max(layers, stackMax)]);

    var y = d3.scaleBand()
        .rangeRound([height - margin.bottom, margin.top])
        .padding(0.1);
    y.domain(data.map(function(d) {
        return 1;
    }))

    function stackMin(layers) {
        return d3.min(layers, function(d) {
            return d[0];
        });
    }

    function stackMax(layers) {
        return d3.max(layers, function(d) {
            return d[1];
        });
    }

    var main_g = svg.append("g")
        .selectAll("g")
        .data(layers);
    var g = main_g.enter().append("g")
        .attr("fill", function(d) {
            return color(d.key);
        });

    var rect = g.selectAll("rect")
        .data(function(d) {
            d.forEach(function(d1) {
                d1.key = d.key;
                return d1;
            });
            return d;
        })
        .enter().append("rect")
        .attr("data", function(d) {
            var data = {};
            data["key"] = d.key;
            data["value"] = d.data[d.key];
            var total = 0;
            group.map(function(d1) {
                total = total + d.data[d1]
            });
            data["total"] = total;
            return JSON.stringify(data);
        })
        .attr("width", function(d) {
            return x(d[1]) - x(d[0]);
        })
        .attr("x", function(d) {
            return x(d[0]);
        })
        .attr("height", y.bandwidth);

    rect.on("mouseover", function(d){
            tooltip.text(d.key + ": " + d.data[d.key]);
            tooltip.style("visibility", "visible");
        })
        .on("mousemove", function(){
            return tooltip.style("top", (event.pageY-10)+"px").style("left",(event.pageX+10)+"px");
        })
        .on("mouseout", function(){
            tooltip.style("visibility", "hidden");
        });
</script>

<hr class="mt-5 mb-5"/>