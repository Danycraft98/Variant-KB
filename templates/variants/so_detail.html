{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="card mt-4">
    <div class="card-header d-flex">
        <h5 class="mr-auto"><strong>{{ item.name }}</strong></h5>
        <div class="dropdown no-arrow">
            <a class="dropdown-toggle btn btn-default" href="#" role="button" id="dropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <i class="fas fa-ellipsis-v fa-sm fa-fw text-gray-400"></i>
            </a>
            <div class="dropdown-menu dropdown-menu-right shadow animated--fade-in" aria-labelledby="dropdownMenuLink">
                <div class="dropdown-header">Options:</div>
                <a class="dropdown-item" href="#" onclick="window.print();return false;">Print</a>
                <a class="dropdown-item" href="{% url 'history' item.id %}">History</a>
                <a class="dropdown-item" href="{% url 'export' item.id %}">Export</a>
            </div>
        </div>
    </div>
    <div class="card-body container pt-5">
        {% include 'partials/_detail.html' %}
        <br/>

        {% for disease in item.diseases.all %}
        <div class="card">
            <a data-toggle="collapse" data-target="#d{{ disease.id }}">
                <div class="card-header d-flex">
                    <h6><strong>Disease: {{ disease.name }}</strong></h6>
                    <i id="d0_icon" class="fa fa-chevron-down ml-auto" aria-hidden="true"></i>
                </div>
            </a>
            <div id="d{{ disease.id }}" class="card-body ml-3 collapse">
                {% for set in disease.functionals.all %}
                {% if forloop.counter == 1 %}
                <div class="row form-group">
                    <div class="col-3"><strong>Functional Significance</strong></div>
                    <div class="col-3">{{ set.key }}</div>
                </div>
                {% endif %}
                <div class="row form-group">
                    <div class="col-3"><strong>Functional Class</strong></div>
                    <div class="col-3">{{ set.value }}</div>
                </div>
                {% for evidence in set.evidences.all %}
                <div class="row form-group">
                    <div class="col-3"><strong>Source Type</strong></div>
                    <div class="col-2">{{ evidence.get_source_type_display }}</div>
                </div>
                <div class="row form-group">
                    <div class="col-3"><strong>Source ID</strong></div>
                    <div class="col-2">{{ evidence.source_id }}</div>
                </div>
                <div class="row form-group mb-4">
                    <div class="col-3"><strong>Evidence Statement</strong></div>
                    <div class="col-7">{{ evidence.statement }}</div>
                    <div class="col-2">{{ evidence.histories.last }}</div>
                </div>
                {% endfor %}
                <hr/>
                {% endfor %}
                {% for evidence in disease.evidences.all %}
                <div class="row form-group">
                    <div class="col-3"><strong>Source Type</strong></div>
                    <div class="col-2">{{ evidence.get_source_type_display }}</div>
                </div>
                <div class="row form-group">
                    <div class="col-3"><strong>Source ID</strong></div>
                    <div class="col-2">{{ evidence.source_id }}</div>
                </div>
                <div class="row form-group">
                    <div class="col-3"><strong>Evidence Statement</strong></div>
                    <div class="col-7">{{ evidence.statement }}</div>
                    <div class="col-2">{{ evidence.histories.last }}</div>
                </div>
                {% with sub=evidence.subevidences.first %}
                <div class="row form-group">
                    <div class="col-3"><strong>Evidence Significance</strong></div>
                    <div class="col-2">{{ sub.evid_sig }}</div>
                </div>
                <div class="row form-group">
                    <div class="col-3"><strong>Evidence Level</strong></div>
                    <div class="col-2">{{ sub.level }}</div>
                </div>
                <div class="row form-group">
                    <div class="col-3"><strong>Evidence Direction</strong></div>
                    <div class="col-2">{{ sub.evid_dir }}</div>
                </div>
                <div class="row form-group">
                    <div class="col-3"><strong>Clinical Significance</strong></div>
                    <div class="col-2">{{ sub.clin_sig }}</div>
                </div>
                <div class="row form-group">
                    <div class="col-3"><strong>Drug / Class</strong></div>
                    <div class="col-2">{{ sub.drug_class }}</div>
                </div>
                <div class="row form-group">
                    <div class="col-3"><strong>Significance</strong></div>
                    <div class="col-2">{{ sub.evid_rating }}</div>
                </div>
                {% endwith %}
                <hr/>
                {% endfor %}
                <hr/>
                <h6>Reports</h6>
                {% for report in disease.reports.all %}
                <div class="row form-group">
                    <div class="col-3"><strong>{{ report.name }}</strong></div>
                    <div class="col-9">{{ report.content }}</div>
                </div>
                {% endfor %}
            </div>
        </div>
        <br/>

        {% endfor %}
    </div>
</div>

<script src="{% static 'gp_add_evidence.js' %}"></script>
{% endblock %}