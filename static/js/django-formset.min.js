/*! Django Formset - v0.3.0 - 2014-11-15
* https://github.com/mbertheau/jquery.django-formset
* Copyright (c) 2014 Markus Bertheau; Licensed MIT */
const __hasProp={}.hasOwnProperty,__extends=function(t,e){function i(){this.constructor=t}for(const i in e)__hasProp.call(e,i)&&(t[i]=e[i]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t};!function(t){let e;t.fn.djangoFormset=function(e){return new t.fn.djangoFormset.Formset(this,e)},e=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return __extends(e,t),e}(Error),t.fn.djangoFormset.Formset=function(){function i(i,s){let n,o,r,a;if(this.opts=t.extend({},t.fn.djangoFormset.defaultOptions,s),0===i.length)throw new e("Empty selector.");if(this.template=i.filter("."+this.opts.formTemplateClass),0===this.template.length)throw new e("Can't find template (looking for ."+this.opts.formTemplateClass+")");if(!(r=this.template.find("input,select,textarea").first().attr("name")))throw new e("Can't figure out form prefix because there's no form element in the form template. Please add one.");if(-1===(a=r.indexOf("-__prefix__")))throw new e("Can't figure out form prefix from template because it doesn't contain '-__prefix__'.");if(this.prefix=r.substring(0,a),this.totalForms=t("#id_"+this.prefix+"-TOTAL_FORMS"),0===this.totalForms.length)throw new e("Management form field 'TOTAL_FORMS' not found for prefix "+this.prefix+".");this._initTabs(),o=i.not("."+this.opts.formTemplateClass),this.initialForms=o.length,t(this).on(this.opts.on),this.forms=o.map(function(e){return function(i,s){var n,o,r;return e.hasTabs&&(r=t.djangoFormset.getTabActivator(s.id),o=new e.opts.tabClass(r.closest(".nav > *"))),n=new e.opts.formClass(t(s),e,i,o),t(e).trigger("formInitialized",[n]),n}}(this)),this.forms.length!==parseInt(this.totalForms.val()),(n=this.forms.filter(function(){return this.deleteInput.val()})).each(function(){return this.delete()}),this.insertAnchor=i.not("."+this.opts.formTemplateClass).last(),0===this.insertAnchor.length&&(this.insertAnchor=this.template)}return i.prototype._initTabs=function(){var i,s;if(this.hasTabs=this.template.is(".tab-pane"),this.hasTabs){if(0===(i=t.djangoFormset.getTabActivator(this.template.attr("id"))).length)throw new e("Template is .tab-pane but couldn't find corresponding tab activator.");if(0===(s=i.closest(".nav")).length)throw new e("Template is .tab-pane but couldn't find corresponding .nav.");if(this.tabTemplate=s.children("."+this.opts.formTemplateClass),0===this.tabTemplate.length)throw new e("Tab nav template not found (looking for ."+this.opts.formTemplateClass+").")}},i.prototype.addForm=function(){var e,i,s,n,o;return this.hasTabs&&(n=this.tabTemplate.clone().removeClass(this.opts.formTemplateClass),s=new this.opts.tabClass(n),o=this.forms.length>0?this.forms[this.forms.length-1].tab.elem:this.tabTemplate,n.insertAfter(o)),i=this.template.clone().removeClass(this.opts.formTemplateClass),e=new this.opts.formClass(i,this,parseInt(this.totalForms.val()),s),i.insertAfter(this.insertAnchor),this.insertAnchor=i,this.forms.push(e),this.totalForms.val(parseInt(this.totalForms.val())+1),this.hasTabs&&s.activate(),t(this).trigger("formInitialized",[e]),t(this).trigger("formAdded",[e]),e},i.prototype.deleteForm=function(t){this.forms[t].delete()},i.prototype.handleFormRemoved=function(t){var e,i,s,n;for(this.totalForms.val(parseInt(this.totalForms.val())-1),this.forms.splice(t,1),e=i=0,s=(n=this.forms).length;s>i;e=++i)n[e]._updateFormIndex(e);this.insertAnchor=0===this.forms.length?this.template:this.forms[this.forms.length-1].elem},i}(),t.fn.djangoFormset.Form=function(){function e(t,e,i,s){this.elem=t,this.formset=e,this.index=i,this.tab=s,this.elem.data("djangoFormset.Form",this),void 0!==this.index&&this._initFormIndex(this.index),this.deleteInput=this.field("DELETE"),this.deleteInput.length,this._replaceDeleteCheckboxWithButton()}return e.prototype.getDeleteButton=function(){return t("<button type='button' class='btn btn-danger'> "+this.formset.opts.deleteButtonText+" </button>")},e.prototype.insertDeleteButton=function(){this.deleteInput.length>0?this.deleteInput.after(this.deleteButton):(this.elem.is("TR")?this.elem.children().last():this.elem.is("UL")||this.elem.is("OL")?this.elem.append("li").children().last():this.elem).append(this.deleteButton)},e.prototype.delete=function(){let t,e,i;return t=this.index<this.formset.initialForms,0===this.deleteInput.length&&t?void console.warn("Tried do delete non-deletable form "+this.formset.prefix+" #"+this.index+"."):(this.tab&&this.tab.elem.is(".active")&&(0===(e=(i=this.formset.forms.map(function(t,e){return e.tab.elem[0]})).slice(this.index+1).filter(":visible").first()).length&&(e=i.slice(0,this.index).filter(":visible").last()),e.length>0&&e.data("djangoFormset.tab").activate()),void(t?(this.deleteInput.length>0&&this.deleteInput.val("on"),this.tab&&this.tab.elem.hide(),this.hide()):(this.tab&&this.tab.elem.remove(),this.elem.remove(),this.formset.handleFormRemoved(this.index))))},e.prototype.hide=function(){return this.elem.hide()},e.prototype.field=function(t){return this.elem.find("[name='"+this.formset.prefix+"-"+this.index+"-"+t+"']")},e.prototype.prev=function(){let t,e,i;for(e=(i=this.formset.forms.slice(0,+(this.index-1)+1||9e9)).length-1;e>=0;e+=-1)if((t=i[e]).elem.is(":visible"))return t},e.prototype._replaceDeleteCheckboxWithButton=function(){let e,i;this.deleteInput.length>0&&(i=t("<input type='hidden' name='"+this.deleteInput.attr("name")+"' id='"+this.deleteInput.attr("id")+"' value='"+(this.deleteInput.is(":checked")?"on":"")+"'/>"),(e=this.elem.find("label[for='"+this.deleteInput.attr("id")+"']")).has(this.deleteInput).length>0?e.replaceWith(i):(e.remove(),this.deleteInput.replaceWith(i)),this.deleteInput=i),this.deleteButton=this.getDeleteButton(),this.deleteButton.on("click",function(t){return function(){return t.delete()}}(this)),this.insertDeleteButton()},e.prototype._replaceFormIndex=function(e,i){let s,n,o;this.index=i,n=new RegExp(this.formset.prefix+"-"+e),s=this.formset.prefix+"-"+i,(o=function(t){let e,i,o,r,a,l,h;if(o={input:["id","name"],select:["id","name"],textarea:["id","name"],label:["for"],div:["id"],"*":["href","data-target"]},t.length>0){i=[],(r=t.get(0).tagName).toLowerCase()in o&&(i=o[r.toLowerCase()]),i.push.apply(i,o["*"]),h=[];for(a=0,l=i.length;l>a;a++)e=i[a],h.push(t.attr(e)?t.attr(e,t.attr(e).replace(n,s)):void 0);return h}})(this.elem),this.elem.find("input, select, textarea, label").each(function(){o(t(this))}),this.tab&&(o(this.tab.elem),this.tab.elem.find("a, button").each(function(){o(t(this))}))},e.prototype._initFormIndex=function(t){this._replaceFormIndex("__prefix__",t)},e.prototype._updateFormIndex=function(t){this._replaceFormIndex("\\d+",t)},e}(),t.fn.djangoFormset.Tab=function(){function t(t){this.elem=t,this.elem.data("djangoFormset.tab",this)}return t.prototype.activate=function(){return this.elem.find("[data-toggle='tab']").trigger("click")},t.prototype.remove=function(){return this.elem.remove()},t}(),t.fn.djangoFormset.defaultOptions={formTemplateClass:"empty-form",formClass:t.fn.djangoFormset.Form,tabClass:t.fn.djangoFormset.Tab,deleteButtonText:"Delete"},t.djangoFormset={getTabActivator:function(e){return t("[href='#"+e+"'], [data-target='#"+e+"']")}}}(jQuery);